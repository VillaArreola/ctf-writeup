---
import Layout from '../layouts/layout.astro';
import SearchBar from '../components/SearchBar.astro';
import { getCollection } from 'astro:content';

const ctfPosts = await getCollection('ctf');

const simplified = ctfPosts.map((post) => ({
  title: post.data.title,
  platform: post.data.platform,
  slug: post.slug,
  date: new Date(post.data.publishedAt).toLocaleDateString('es-MX'),
  cover: post.data.cover ?? `/images/default-cover.svg`,
  preview: post.data.preview ?? '',
  tags: post.data.tags?.join(' ') ?? ''
}));
---

<Layout>
  <SearchBar />

  <main class="max-w-7xl mx-auto px-6 py-10">
    <div class="grid grid-cols-8 gap-6">
      {simplified.map((post, i) => (
        <a
          href={`/ctf/${post.slug}`}
          class={`group relative ${
            i === 0 || i === 3 ? 'col-span-5' : 
            i === 1 || i === 2 ? 'col-span-3' : 
            'col-span-4'
          }`}
        >
          <div class="bg-gradient-to-b from-[#16181d] to-[#0d0e10] rounded-2xl p-6 shadow-xl hover:scale-[1.01] transition duration-200 border border-gray-800 hover:border-cyan-400">
            <img
              src={post.cover}
              alt={`Portada de ${post.title}`}
              class="w-full h-40 object-cover rounded mb-4"
            />
            <div class="mb-4">
              <h3 class="text-lg font-semibold text-white group-hover:text-cyan-400 transition">
                {post.title}
              </h3>
              <p class="text-sm text-gray-400">
                {post.platform} â€” {post.date}
              </p>
            </div>
            <div class="text-sm text-gray-500 leading-relaxed">
              {post.preview || 'Este writeup aÃºn no tiene descripciÃ³n. ðŸš§'}
            </div>
          </div>
        </a>
      ))}
    </div>
  </main>
</Layout>
